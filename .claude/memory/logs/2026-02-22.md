# 2026-02-22 Daily Log

## 완료 작업: ComfyUI 파이프라인 개선 Epic (Phase 1~4)

### Phase 1: 프롬프트/워크플로우 개선
- constants.ts 신규 (QUALITY_PRESETS, SAMPLER/SCHEDULER_OPTIONS, PROMPT_PREFIXES, DEFAULT_NEGATIVE_PROMPTS)
- types.ts에 negativePrompt/steps/cfgScale/samplerName/scheduler/qualityPreset 추가
- processor.ts: 품질 프리셋 우선 적용, constants 기반 buildPrompt
- 워크플로우 JSON 4개: _meta.parameters에 negative_prompt/steps/cfg/sampler_name/scheduler 추가
- UI: 품질 프리셋 버튼(draft/standard/high) + Advanced 섹션(neg prompt, sampler, scheduler, steps, CFG)

### Phase 2: 배경제거
- post-processor.ts 신규: removeBackground() — 코너 색상 감지 → tolerance 범위 투명화 → 1px feathering
- character/object 타입 기본 true, tolerance 기본값 30
- UI: Remove Background 체크박스 + tolerance 슬라이더

### Phase 3: Seamless 타일
- tileset-seamless.json 워크플로우 신규 (steps=35, cfg=8, dpmpp_2m, karras)
- workflow-loader.ts: variant 지원 (loadWorkflowTemplate(type, variant?))
- post-processor.ts: blendTileEdges() 추가 (2px 범위 엣지 블렌딩)
- UI: Seamless Tiling 체크박스 (tileset 전용)

### Phase 4: ControlNet 포즈 가이드
- capability-checker.ts 신규: /object_info 조회로 ControlNet 노드/모델 감지 (1분 캐시)
- character-controlnet.json 워크플로우 신규
- /api/comfyui/capabilities GET 엔드포인트
- client.ts: getObjectInfo() 메서드 추가
- processor.ts: ControlNet capability 확인 → variant="controlnet" 또는 fallback
- UI: ControlNet Pose Guide 체크박스 + strength 슬라이더 (미설치 시 비활성)

### 빌드 검증
- tsc ✅ lint ✅ build ✅
- 커밋: 0c9a7ba `feat: ComfyUI 파이프라인 개선 (Phase 1~4)` → push 완료

---

---

## 완료 작업: 에셋-게임 연동 수정 Epic (Phase 1)

### Task 2: 에셋 생성 → Phaser 런타임 로드
- main-scene.ts: ASSET_GENERATED 이벤트 리스너 추가 (create → shutdown 해제)
- asset-studio.tsx: handleComplete()에서 loadAssetToPhaser(asset.id) 호출
- 빌드 에러 수정: barrel import(@/features/assets)가 sharp 번들링 → 직접 import로 변경

### Task 3: 맵 에디터에서 생성된 에셋 사용
- editor-store.ts: paletteTab에 "assets" 추가, selectedAssetId 상태
- asset-palette.tsx: NEW — 완료 에셋 목록, 타입 필터, 썸네일 그리드
- editor-sidebar.tsx: "에셋" 3번째 탭 추가
- use-editor.ts: setAssetSelection(), placeObject에 assetId 포함
- space-client.tsx: 새 props 전달

### Task 4: 생성된 캐릭터 → 아바타 적용
- avatar-editor-modal.tsx: [파츠 조합 | AI 캐릭터] 탭 추가
- sprite-generator.ts: custom 타입 동적 로드 + Canvas 스케일 다운 (128x128→32x48)
- 비동기 로드 + 기본 파츠 fallback 패턴

### 추가: 전체 UI 한글화 + 상세 툴팁
- 13개 파일 한글화 (prompt-editor, asset-generate-form, asset-studio, asset-preview 등)
- 모든 필드에 title 속성으로 상세 한글 설명 추가
- ControlNet "(미설치)" → "(설정 필요)" 변경

### 추가: ControlNet 설치
- comfyui_controlnet_aux 노드 설치 (custom_nodes/)
- control_v11p_sd15_openpose.pth 모델 다운로드 (1.38GB)
- Python 의존성 설치 (scipy, einops, fvcore 등)

### 빌드 검증
- tsc ✅ lint ✅ build ✅
- 커밋 대기 (다음 세션에서 진행)

### Handoff Notes
- 다음 세션: git commit + push 진행
- 커밋 대상: 에셋-게임 연동 + UI 한글화 + ControlNet 설치
