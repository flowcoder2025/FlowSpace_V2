# 2026-02-22 Daily Log

## 완료 작업: ComfyUI 파이프라인 개선 Epic (Phase 1~4)

### Phase 1: 프롬프트/워크플로우 개선
- constants.ts 신규 (QUALITY_PRESETS, SAMPLER/SCHEDULER_OPTIONS, PROMPT_PREFIXES, DEFAULT_NEGATIVE_PROMPTS)
- types.ts에 negativePrompt/steps/cfgScale/samplerName/scheduler/qualityPreset 추가
- processor.ts: 품질 프리셋 우선 적용, constants 기반 buildPrompt
- 워크플로우 JSON 4개: _meta.parameters에 negative_prompt/steps/cfg/sampler_name/scheduler 추가
- UI: 품질 프리셋 버튼(draft/standard/high) + Advanced 섹션(neg prompt, sampler, scheduler, steps, CFG)

### Phase 2: 배경제거
- post-processor.ts 신규: removeBackground() — 코너 색상 감지 → tolerance 범위 투명화 → 1px feathering
- character/object 타입 기본 true, tolerance 기본값 30
- UI: Remove Background 체크박스 + tolerance 슬라이더

### Phase 3: Seamless 타일
- tileset-seamless.json 워크플로우 신규 (steps=35, cfg=8, dpmpp_2m, karras)
- workflow-loader.ts: variant 지원 (loadWorkflowTemplate(type, variant?))
- post-processor.ts: blendTileEdges() 추가 (2px 범위 엣지 블렌딩)
- UI: Seamless Tiling 체크박스 (tileset 전용)

### Phase 4: ControlNet 포즈 가이드
- capability-checker.ts 신규: /object_info 조회로 ControlNet 노드/모델 감지 (1분 캐시)
- character-controlnet.json 워크플로우 신규
- /api/comfyui/capabilities GET 엔드포인트
- client.ts: getObjectInfo() 메서드 추가
- processor.ts: ControlNet capability 확인 → variant="controlnet" 또는 fallback
- UI: ControlNet Pose Guide 체크박스 + strength 슬라이더 (미설치 시 비활성)

### 빌드 검증
- tsc ✅ lint ✅ build ✅
- 커밋: 0c9a7ba `feat: ComfyUI 파이프라인 개선 (Phase 1~4)` → push 완료

---

## 미완료: 연동 문제 진단 결과 (다음 세션 작업)

### 수정 우선순위
1. **인게임 아바타 에디터 버튼 추가** (낮음) — showAvatarEditor state 있지만 여는 버튼 없음
2. **에셋 생성 → Phaser 텍스처 로드 연동** (중간) — loadAssetToPhaser() 호출처 없음, ASSET_GENERATED 리스너 없음
3. **맵 에디터에서 생성된 에셋 사용** (높음) — 타일셋/오브젝트 배치 UI 없음
4. **생성된 캐릭터 → 아바타 적용** (중간) — 커스텀 캐릭터를 아바타로 쓸 수 없음

### 파츠 캐릭터 상태
- 핵심 기능 (에디터UI/Phaser렌더링/DB/소켓/온보딩) 모두 ✅
- 유일한 문제: space-client.tsx에 모달 여는 버튼 없음
- 위치: `src/app/space/[id]/space-client.tsx` L43 showAvatarEditor, L522 AvatarEditorModal

### 에셋 파이프라인 상태
- 생성 → 파일저장 → DB 기록 ✅
- 게임 연동 전혀 없음 ❌
- processor.ts에 DEBUG 로그 추가됨 (제거 필요)
